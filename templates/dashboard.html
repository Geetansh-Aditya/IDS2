<!DOCTYPE html>
<html>
<head>
    <title>Network Security Monitor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .dashboard-container {padding: 20px;}
        .panel {height: 80vh; overflow-y: auto;}
        .threat-critical {background-color: #ffb3b3;}
        .threat-high {background-color: #ffe6b3;}
        .packet-row {font-family: monospace; font-size: 0.9em;}
    </style>
</head>
<body>
    <div class="dashboard-container container-fluid">
        <h2 class="text-center mb-4">Network Security Monitor</h2>
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">Live Traffic</div>
                    <div class="card-body panel">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Source</th>
                                    <th>Destination</th>
                                    <th>Protocol</th>
                                    <th>Ports</th>
                                    <th>Length</th>
                                </tr>
                            </thead>
                            <tbody id="packet-list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-danger text-white">Security Alerts</div>
                    <div class="card-body panel">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Threat</th>
                                    <th>Source</th>
                                    <th>Severity</th>
                                </tr>
                            </thead>
                            <tbody id="alert-list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function updateDashboard() {
            fetch('/api/data')
                .then(response => response.json())
                .then(data => {
                    updatePacketList(data.packets);
                    updateAlertList(data.threats);
                });
        }

        function updatePacketList(packets) {
            const tbody = document.getElementById('packet-list');
            tbody.innerHTML = packets.map(packet => `
                <tr class="packet-row">
                    <td>${packet.timestamp.split(' ')[1]}</td>
                    <td>${packet.src_ip}</td>
                    <td>${packet.dst_ip}</td>
                    <td>${getProtocolName(packet.protocol)}</td>
                    <td>${getPorts(packet)}</td>
                    <td>${packet.length}</td>
                </tr>
            `).join('');
        }

        function updateAlertList(alerts) {
            const tbody = document.getElementById('alert-list');
            tbody.innerHTML = alerts.map(alert => `
                <tr class="threat-${alert.severity}">
                    <td>${alert.timestamp.split(' ')[1]}</td>
                    <td>${alert.threat}</td>
                    <td>${alert.ip}</td>
                    <td>${alert.severity.toUpperCase()}</td>
                </tr>
            `).join('');
        }

        function getProtocolName(protoNum) {
            const protocols = {1: 'ICMP', 6: 'TCP', 17: 'UDP'};
            return protocols[protoNum] || protoNum;
        }

        function getPorts(packet) {
            if (packet.sport && packet.dport)
                return `${packet.sport} â†’ ${packet.dport}`;
            return '-';
        }

        // Update every second
        setInterval(updateDashboard, 1000);
        updateDashboard();
    </script>
</body>
</html>